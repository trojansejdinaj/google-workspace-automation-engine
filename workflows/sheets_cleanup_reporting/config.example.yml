workflow:
  name: sheets_cleanup_reporting

sheets:
  sheet_id: "DUMMY_SHEET_ID"          # spreadsheet id

tabs:
  input_tab: "raw"
  cleaned_tab: "cleaned"
  report_tab: "report"

rules:
  # Back-compat (still used as defaults if schema not fully defined)
  required_columns:
    - id
    - date
    - description
    - amount
  optional_columns:
    - category
    - status

  # NEW: explicit schema = single source of truth
  schema:
    id:
      type: string
      required: true
      allow_blank: false
    date:
      type: date_iso
      required: true
      allow_blank: false
    description:
      type: string
      required: true
      allow_blank: false
    amount:
      type: number
      required: true
      allow_blank: false
    category:
      type: string
      required: false
      allow_blank: true
    status:
      type: string
      required: false
      allow_blank: true

  # idempotency key preference:
  idempotency_key:
    primary: "id"
    fallback_fields: ["date", "description", "amount", "category"]

transforms:
  strings:
    trim: true
    collapse_spaces: true
    case:
      # per-field override: lower|upper|title|none
      description: title
      category: lower

  dates:
    # accepted input formats (normalize to YYYY-MM-DD)
    formats: ["%Y-%m-%d", "%d/%m/%Y", "%m/%d/%Y"]

  numbers:
    strip_commas: true

dedupe:
  # applied AFTER transforms + validation
  keys: ["id"]
  keep: first   # first|last

reporting:
  # example knobs (keep simple at first)
  include_category_totals: true
  include_amount_totals: true
  max_issue_examples: 25
